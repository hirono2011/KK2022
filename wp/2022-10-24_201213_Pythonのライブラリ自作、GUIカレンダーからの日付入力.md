### Pythonのライブラリ自作、GUIカレンダーからの日付入力　-　本件刑事告発・非常上告事件＼金沢地方検察庁御中

:CATEGORIES: @kanazawabengosi #金沢弁護士会 @JFBAsns 日本弁護士連合会（日弁連） #法務省 @MOJ_HOUMU #参考資料


## 目的の機能

h3-mysql-regexp-html.py -s '.*' --range '2022-10-11 00:00/2022-10-11 23:59:59' --bpost True

これまでは上記のように日付の文字列を引数に渡していたのですが、GUIのカレンダーでマウス操作から入力したいと考えました。以前にやったことはあったのですが、Rubyだったかもしれません。機能を追加し次のように実行できるようにしました。

h3-mysql-regexp-html.py -s '久礼' --cal True

- TW kk_hirono（刑事告発・非常上告＿金沢地方検察庁御中） 日時： 2022/10/23 13:40:45 URL： https://twitter.com/kk_hirono/status/1584042116086276097  
> SS: 2022-10-23_131901_func_cal2。py　-　kk_python　-　Visual　Studio　Code.jpg https://t.co/UhcVHrAY5J  

> SS: 2022-10-23_131901_func_cal2。py　-　kk_python　-　Visual　Studio　Code.jpg [pic.twitter.com/UhcVHrAY5J](https://t.co/UhcVHrAY5J)
>     
>     — 刑事告発・非常上告＿金沢地方検察庁御中 (@kk_hirono) [October 23, 2022](https://twitter.com/kk_hirono/status/1584042116086276097?ref_src=twsrc%5Etfw)

　テスト用のスクリプトからの実行ですが、ライブラリのモジュールが呼び出され、2つのカレンダーが横に並んだウィンドウが表示されます。左が処理開始の年月日、右が処理終了の年月日の入力になります。

　「DateEntry(style='my.DateEntry')」を使うと、テキストボックスが表示され、右端のクリックでカレンダーが表示され、同じく選択ができるのですが、テキストボックスに直接、日付を打ち込むことができるようです。

　カレンダーだけだと10年前の場合、10回もボタンのクリックが必要となるのでけっこうな手間になります。「Calendar()」メソッドとは違い、値の形式が半角ハイフンの区切りになっていました。「s = s.replace('/', '-')」という処理も不要になります。

　「self.master.data_entry_date = DateEntry(style='my.DateEntry')」と「 self.master.calender_date2 = DateEntry(style='my.DateEntry')」の違いがわからないのですが、どちらも別々に問題なく動作するようです。

　さきほど、「self.master.calender_date = DateEntry(style='my.DateEntry')」とやるとエラーが出ていたような気がするのですが、それで「calender_date」の部分を「data_entry_date」に修正していました。

　Pythonのクラスも使い慣れていないのですが、久しぶりに使うと基本的なところで大ハマリをしていました。Pythonのライブラリを作成したのも今回が初めてになるのですが、これはすんなり出来たようです。

　最初にfunc_cal.pyという編集していたのですがエラーが連発し、致命的なエラーが解消したところでfunc_cal2.pyというコピーを作成し、そちらで作業を続けました。

　ネットで参考にしたページでは、外部クラスを呼び出すスクリプトの方でtkinterのインスタンスを作成し呼び出す外部クラスの引数にしていたのですが、tkinterのインスタンスの扱いに誤解があって、違った方向に流れていました。

　func_cal2.pyが自分なりに考えて、引数なしで動作するようにしたものです。tkinterを使ったスクリプトの作成も久しぶりだったのですが、次第に思い出すこともあって、なんとかなったようです。情報が探しづらいのもtkinterの苦い経験でした。

　ライブラリの最上位のディレクトリで、「pip install .」とやると、「from kk_python import Tkcalender」という宣言で、自作のライブラリーが使えるようになりました。「pip install .」のドットの意味はわかりますが、見たのも初めてです。

　「pip install ライブラリ名」というコマンドの使い方は、Pythonを使い始めてから使っていると思いますが、「pip install .」をこれまで一度も見かけなかったのが不思議に思え、最近はこのような発見がいくつかありました。

- 高速スクリプト言語 [Lua] を始めよう — WTOPIA v1.0 documentation https://t.co/nx6YytHJ5h

　上記のLuaがそうでした。「lualatex」というコマンドはよく使って時期があるのですが、このLuaというプログラム言語で作成されているらしいと初めて知りました。

　今朝は4時40分頃に目が覚めて、それからまもなくPythonのライブラリの作成に取り掛かったと思うのですが、12時少し前ぐらいにようやくうまく行きました。前々からやっておきたかったことの1つです。

## 作成したライブラリのファイル

[kk_python] tree                                                                                                                                                                                                       14:40:04 
.
├── build
│   ├── bdist.linux-x86_64
│   └── lib
│       └── kk_python
│           ├── __init__.py
│           ├── func2_cal.py
│           ├── func_cal.py
│           └── func_cal2.py
├── kk_python
│   ├── __init__.py
│   ├── __pycache__
│   │   ├── __init__.cpython-310.pyc
│   │   ├── func_cal.cpython-310.pyc
│   │   └── func_cal2.cpython-310.pyc
│   ├── func_cal.py
│   ├── func_cal.py.back
│   └── func_cal2.py
├── kk_python.egg-info
│   ├── PKG-INFO
│   ├── SOURCES.txt
│   ├── dependency_links.txt
│   └── top_level.txt
├── main.py
├── main2.py
└── setup.py

7 directories, 18 files

自動でファイルが生成されていますが、自分で作成したのは次の6つのファイルになると思います。

from setuptools import setup, find_packages

setup(
    name='kk_python',
    version='0.1',
    packages=find_packages()
)

#!python

import tkinter
from kk_python import Tkcalender

def main():
    s = ""
    e = ""

    root = tkinter.Tk()
    c = Tkcalender(master=root)
    s,e = c.get_time()
    #s = s.replace('/', '-')
    #e = e.replace('/', '-')
    print(s)

if __name__ == "__main__":
    main()

#!python

import tkinter
from kk_python import Tkcalender2

def main():
    s = ""
    e = ""

    c=Tkcalender2()
    s,e = c.get_time()
    s = s.replace('/', '-')
    e = e.replace('/', '-')
    print(s)
    #root.mainloop()

if __name__ == "__main__":
    main()

from .func_cal import Tkcalender
from .func_cal2 import Tkcalender2

import tkinter
from tkinter import ttk
from tkcalendar import Calendar, DateEntry

class Tkcalender(tkinter.Frame):
    def __init__(self,master):
        super().__init__(master)

        self.pack()
        self.master.title("tkカレンダーテスト")
        self.master.geometry("660x330")

        # カレンダーのスタイル
        self.master.style = ttk.Style()
        self.master.style.theme_use('clam')
        self.master.style.configure('my.DateEntry',
                        fieldbackground='light green',
                        background='dark green',
                        foreground='dark orange',
                        arrowcolor='white')

        self.master.data_entry_date = DateEntry(style='my.DateEntry')
        self.master.data_entry_date.place(x=30, y=30)

        #self.master.calender_date = Calendar()
        #self.master.calender_date.place(x=30, y=30)

        self.master.calender_date2 = DateEntry(style='my.DateEntry')
        self.master.calender_date2.place(x=330, y=30)
        self.startTime = self.master.data_entry_date.get_date()
        self.endTime = self.master.calender_date2.get_date()
        self.master.print_button = tkinter.Button(self.master,text="実行", bg="coral", font=("Times New Roman", 10), command=self.click_print)
        self.master.print_button.place(x=530, y=270, width=90, height=40)

        self.master.mainloop()
        #print(self.startTime, self.endTime)
        #return self.startTime, self.endTime

    def click_print(self):
        self.startTime = self.master.data_entry_date.get_date()
        self.endTime = self.master.calender_date2.get_date()
        print(self.master.data_entry_date.get_date())
        print(self.master.calender_date2.get_date())
        self.master.destroy()

    def get_time(self):
        return  self.startTime, self.endTime

def main():
    root = tkinter.Tk()
    root = Tkcalender(master=root)
    root.mainloop()

if __name__ == "__main__":
    main()

import tkinter
from tkinter import ttk
from tkcalendar import Calendar, DateEntry

class Tkcalender2:
    def __init__(self):
        self.root = tkinter.Tk() 

        self.root.title("tkカレンダー")
        self.root.geometry("660x330")

        # カレンダーのスタイル
        self.root.style = ttk.Style()
        self.root.style.theme_use('clam')
        self.root.style.configure('my.DateEntry',
                        fieldbackground='light green',
                        background='dark green',
                        foreground='dark orange',
                        arrowcolor='white')

        #self.root.data_entry_date = DateEntry(style='my.DateEntry')
        #self.root.data_entry_date.place(x=30, y=90)

        self.root.calender_date = Calendar()
        self.root.calender_date.place(x=30, y=30)

        self.root.calender_date2 = Calendar()
        self.root.calender_date2.place(x=330, y=30)
        self.startTime = self.root.calender_date.get_date()
        self.endTime = self.root.calender_date2.get_date()
        self.root.print_button = tkinter.Button(self.root,text="実行", bg="coral", font=("Times New Roman", 10), command=self.click_print)
        self.root.print_button.place(x=530, y=270, width=90, height=40)

        self.root.mainloop()
        #print(self.startTime, self.endTime)
        #return self.startTime, self.endTime

    def click_print(self):
        self.startTime = self.root.calender_date.get_date()
        self.endTime = self.root.calender_date2.get_date()
        print(self.root.calender_date.get_date())
        print(self.root.calender_date2.get_date())
        self.root.destroy()

    def get_time(self):
        return  self.startTime, self.endTime

def main():
    root = tkinter.Tk()
    root = Tkcalender(root=root)
    root.mainloop()

if __name__ == "__main__":
    main()

## 他のスクリプトからの自作ライブラリのモジュールの利用

 その他省略↑

from kk_python import Tkcalender2

# その他省略↑
parser.add_argument('--cal', help='カレンダーを使った入力', type=bool)
# その他省略↓

    if args.cal:
        c=Tkcalender2()
        s,e = c.get_time()
        s = s.replace('/', '-')
        e = e.replace('/', '-')
        stime = "{s} 00:00".format(s=s)
        etime = "{e} 23:59:59".format(e=e)

        # WHERE date BETWEEN '{stime}*' AND '{etime}'
        sql = "SELECT * FROM tw_hirono WHERE date BETWEEN '{stime}' AND '{etime}' AND (tweet REGEXP '{word}') ORDER BY date ASC".format(word=word, stime=stime, etime=etime)
        h1_sql = "SELECT COUNT(*) FROM tw_hirono WHERE date BETWEEN '{stime}' AND '{etime}' AND (tweet REGEXP '{word}')  AND user LIKE 'hirono_hideki' ORDER BY date ASC".format(word=word, stime=stime, etime=etime)
        h2_sql = "SELECT COUNT(*) FROM tw_hirono WHERE date BETWEEN '{stime}' AND '{etime}' AND (tweet REGEXP '{word}')  AND user LIKE 'kk_hirono' ORDER BY date ASC".format(word=word, stime=stime, etime=etime)
        h3_sql = "SELECT COUNT(*) FROM tw_hirono WHERE date BETWEEN '{stime}' AND '{etime}' AND (tweet REGEXP '{word}')  AND user LIKE 's_hirono' ORDER BY date ASC".format(word=word, stime=stime, etime=etime)

        #sys.exit()
    else:
        sql = "SELECT * FROM tw_hirono WHERE tweet REGEXP '{word}' ORDER BY date ASC".format(word=word)
        h1_sql = "SELECT COUNT(*) FROM tw_hirono WHERE tweet REGEXP '{word}' AND user LIKE 'hirono_hideki' ORDER BY date ASC".format(word=word)
        h2_sql = "SELECT COUNT(*) FROM tw_hirono WHERE tweet REGEXP '{word}' AND user LIKE 'kk_hirono' ORDER BY date ASC".format(word=word)
        h3_sql = "SELECT COUNT(*) FROM tw_hirono WHERE tweet REGEXP '{word}' AND user LIKE 's_hirono' ORDER BY date ASC".format(word=word) 

# その他省略↓

## 参考ページ

- 自作ライブラリを作成してみよう | StartLab –Python特化のプログラミングスクール– <https://t.co/AdttDrlGPP>

- Pythonで自分だけのクソライブラリを作る方法 <https://t.co/bjQzFHOcLC>

- Pythonのモジュール、パッケージ、ライブラリ徹底解説！ - AI-interのPython3入門 <https://t.co/TfMTnIo3Lr>

- Pythonのクラス（class）の基本を徹底解説、具体的な書き方も | プログラミングを学ぶならトレノキャンプ（TRAINOCAMP） <https://t.co/cXEqensoEP>

Follow me!


# 関連記事



[スクレイピングでファイルを作成するPythonスクリプトの改良（2）](http://hirono-hideki.info/kk2022/2022-10-10_564)

 __2022-10-10_165256



[スクレイピングでファイルを作成するPythonスクリプトの改良](http://hirono-hideki.info/kk2022/2022-10-09_499)

 __2022-10-09_114853



[スクレイピングでWordPressの記事のテキストを取得し、ファイルも作成するPythonスクリプト](http://hirono-hideki.info/kk2022/2022-10-06_218)

 __2022-10-06_143135



[WordPressの記事をテキストデータで取得するpythonスクリプト](http://hirono-hideki.info/kk2022/2022-10-05_138)

 __2022-10-05_060843



最終更新日時：2022-10-24_201213
