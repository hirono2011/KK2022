### レンタルサーバーのコマンドラインでのWordPressを操作するphpファイルの実行　-　本件刑事告発・非常上告事件＼金沢地方検察庁御中

:CATEGORIES: @kanazawabengosi #金沢弁護士会 @JFBAsns 日本弁護士連合会（日弁連） #法務省 @MOJ_HOUMU #参考資料


　ずっと前からやりたかったというかできるようにしておきたかったことで、ようやく腰を上げて取り組んだのが昨日2022年10月13日の夕方のことでした。思ったように情報も集まらず、試行錯誤を繰り返しました。

　データベースから取得したデータを変数に入れても文字列の連結が出来ず、失敗を繰り返して狐につままれたような気分になっていたのですが、一応完成後に気がついたのが、ブラウザと同じphp特有の出力でした。

　それに気がつくと、「require_once('./wp-load.php');」という一文を入れるだけで、ブラウザのWordPressと同じようにphpが使えるらしいとわかってきました。前はブラウザで実行した結果をコピペで使っていたのですが、コマンドラインだと出力をファイルに保存も簡単です。

　1年ほど前にネットで見つけたコードをほぼそのまま貼り付けて使っていたのですが、最初は処理結果の出力データだけを得ようとしていました。HTMLタグは不要なので除去していますが、次の1つ目が自分なりにやってみたもの2つ目がほぼ前のコードになります。

<?php
require_once('./wp-load.php');
$paged = (int) get_query_var('paged');
$args = array(
        'posts_per_page' => 1000,
        'paged' => $paged,
        'orderby' => 'post_date',
        'order' => 'ASC',
        'post_type' => 'post',
        'post_status' => 'publish'
);
$the_query = new WP_Query($args);
if ( $the_query->have_posts() ) :
        while ( $the_query->have_posts() ) : $the_query->the_post();
                the_time("Y年m月d日H時i分s秒");
                echo ",";
                $update_time = the_modified_date("Y年m月d日H時i分s秒"); 
                echo ",";
                $title = the_title();
                echo ",";
                $url =  the_permalink();
                echo "\n";
                #echo "{$title} qqqq";
                #echo  $time . ',' . $update_time . ',' . $title . ',' . $url . "\n";
        endwhile;
endif;
?>

<?php
#よろしくです。
?>

<?php
/**
 * Template Name: テンプレート名 */
require_once('./wp-load.php');
?>
<?php
$paged = (int) get_query_var('paged');
$args = array(
        'posts_per_page' => 1000,
        'paged' => $paged,
        'orderby' => 'post_date',
        'order' => 'ASC',
        'post_type' => 'post',
        'post_status' => 'publish'
);
$the_query = new WP_Query($args);
if ( $the_query->have_posts() ) :
        while ( $the_query->have_posts() ) : $the_query->the_post();
?>
<?php the_time("Y年m月d日 H時i分s秒"); ?>,<?php the_modified_date("Y年m月d日 H時i分s秒"); ?>,<?php the_title(); ?>,<?php the_permalink(); ?>

<?php endwhile; endif; ?>
<?php
if ($the_query->max_num_pages > 1) {
        echo paginate_links(array(
                'base' => get_pagenum_link(1) . '%_%',
                'format' => 'page/%#%/',
                'current' => max(1, $paged),
                'total' => $the_query->max_num_pages
        ));
}
?>
<?php wp_reset_postdata(); ?>

　シバン(Shebang)はつけないテキストファイルでパーミッションも600にしています。コマンドラインからは「php -f list2.php」などという実行になります。今のところデータも少ないので端末でのコピペになりますが、次がコマンドの出力結果になります。

2022年10月02日09時23分10秒,2022年10月02日09時23分10秒,Hello world!,http://hirono-hideki.info/kk2022/2022-10-02_1
2022年10月02日09時53分17秒,2022年10月02日09時54分28秒,新規作成開始,http://hirono-hideki.info/kk2022/2022-10-02_28
2022年10月02日10時34分30秒,2022年10月02日10時34分50秒,WordPressの編集画面,http://hirono-hideki.info/kk2022/2022-10-02_33
2022年10月02日11時16分20秒,2022年10月02日11時21分03秒,WordPressでMarkdown,http://hirono-hideki.info/kk2022/2022-10-02_38
2022年10月02日11時32分44秒,2022年10月02日11時32分44秒,URLリンクの問題,http://hirono-hideki.info/kk2022/2022-10-02_43
2022年10月04日16時51分39秒,2022年10月04日17時29分35秒,WordPressのスクレイピングとブロックエディタ,http://hirono-hideki.info/kk2022/2022-10-04_117
2022年10月05日06時08分43秒,2022年10月05日06時25分45秒,WordPressの記事をテキストデータで取得するpythonスクリプト,http://hirono-hideki.info/kk2022/2022-10-05_138
2022年10月05日08時15分05秒,2022年10月05日08時15分06秒,h3-mysql-regexp-html.py -s 米本和広 --bpost True,http://hirono-hideki.info/kk2022/2022-10-05_146
2022年10月05日08時20分20秒,2022年10月05日08時20分22秒,- 山崎 雅弘さんはTwitterを使っています： 「かっこ悪。どこまでもインチキ臭い集団。リテラよく調べたと思う。 菅義偉が国葬弔辞で美談に仕立てた「山縣有朋の歌」,http://hirono-hideki.info/kk2022/2022-10-05_149
2022年10月05日10時33分36秒,2022年10月05日15時45分15秒,岡山県智頭町という海渡雄一弁護士のツイートと、「勾留百二十日」（元・大阪地検特捜部長　大坪弘道）,http://hirono-hideki.info/kk2022/2022-10-05_151
2022年10月06日10時01分15秒,2022年10月06日16時34分58秒,「検察の汚名は一気に返上になるだろう。」というジャーナリスト清水潔氏のツイート,http://hirono-hideki.info/kk2022/2022-10-06_174
2022年10月06日12時31分10秒,2022年10月06日16時56分12秒,ひろゆき氏について、「既存メディアが深刻に捉えなかったことが現状」というジャーナリストの江川紹子氏のリツイート,http://hirono-hideki.info/kk2022/2022-10-06_213
2022年10月06日14時31分35秒,2022年10月06日14時47分48秒,スクレイピングでWordPressの記事のテキストを取得し、ファイルも作成するPythonスクリプト,http://hirono-hideki.info/kk2022/2022-10-06_218
2022年10月07日15時21分25秒,2022年10月08日13時34分52秒,深澤諭史弁護士のTLで気になった「加害者が支配を続けるストーカー促進法になる未来を避けたい」という弁護士アカウント,http://hirono-hideki.info/kk2022/2022-10-07_229
2022年10月08日14時16分53秒,2022年10月09日04時46分26秒,125_第1審事件記録3／3　平成04年04月09日付　供述調書　廣野秀樹　金沢西警察署　司法警察員　警部補　谷内孝志　56頁,http://hirono-hideki.info/kk2022/2022-10-08_273
2022年10月09日04時56分01秒,2022年10月09日04時56分01秒,098_第1審事件記録3／3　平成04年04月07日付　供述調書　廣野秀樹　金沢西警察署　司法警察員　警部補　谷内孝志　70頁,http://hirono-hideki.info/kk2022/2022-10-09_465
2022年10月09日07時22分05秒,2022年10月09日11時27分25秒,「「玉川発言」への批判、謹慎処分は正当なのか」という郷原信郎弁護士のアゴラの記事,http://hirono-hideki.info/kk2022/2022-10-09_470
2022年10月09日11時48分53秒,2022年10月09日11時48分54秒,スクレイピングでファイルを作成するPythonスクリプトの改良,http://hirono-hideki.info/kk2022/2022-10-09_499
2022年10月09日17時27分10秒,2022年10月10日14時20分01秒,歴史と弁護士の謎に迫る：宮城県牡鹿郡女川町と福永活也弁護士,http://hirono-hideki.info/kk2022/2022-10-09_501
2022年10月10日16時52分56秒,2022年10月10日17時06分19秒,スクレイピングでファイルを作成するPythonスクリプトの改良（2）,http://hirono-hideki.info/kk2022/2022-10-10_564
2022年10月11日10時39分20秒,2022年10月11日19時22分52秒,谷内孝志警部補の被疑者供述調書,http://hirono-hideki.info/kk2022/2022-10-11_570
2022年10月11日21時00分31秒,2022年10月12日12時20分34秒,深澤諭史@fukazawasという弁護士灯台,http://hirono-hideki.info/kk2022/2022-10-11_586
2022年10月13日16時13分48秒,2022年10月14日10時29分45秒,WP-CLIでレンタルサーバーのコマンドラインからWordPressのデータベース操作,http://hirono-hideki.info/kk2022/2022-10-13_611

　CSV形式のテキストデータになりますが、エクセルで読み込んでエクセルデータに変換できます。面倒もあるのでpythonから直接エクセルデータを編集することも考えています。これまでに何度かやってきました。

　次がブラウザでの通常のphpの実行になります。少しCSSを使って文字の大きさや文字色を変更しているので、ただのテキストファイルよりは見やすくなっていると思います。

- リスト　-　本件刑事告発・非常上告事件＼金沢地方検察庁御中[ _http://hirono-hideki.info/kk2022/list_](http://hirono-hideki.info/kk2022/list)

Follow me!


# 関連記事



[WP-CLIでレンタルサーバーのコマンドラインからWordPressのデータベース操作](http://hirono-hideki.info/kk2022/2022-10-13_611)

 __2022-10-13_161348



[WordPressの記事をテキストデータで取得するpythonスクリプト](http://hirono-hideki.info/kk2022/2022-10-05_138)

 __2022-10-05_060843



最終更新日時：2022-10-24_201021
